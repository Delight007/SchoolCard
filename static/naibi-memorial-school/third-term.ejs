<html lang="en">
  <head>
    <title><%= data.student.name %> Report Card</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      @page {
        size: A4;
      margin: 0;

      }

      td,
      th {
        border: 2px solid #8c375c;
      }

      body {
        margin: 0;
        font-family: 'Roboto', sans-serif;
        color: #8c375c;
      }

      .container {
        padding: 30px;
      }

      .report-card {
        /*border: 2px solid rgb(165, 117, 48);*/
      }

      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }

      th, td {
      padding: 3px;
      text-align: center;
      }

      @media screen and (max-width: 768px) {
        .header {
          align-items: start !important;
          gap: 4px !important;
        }
        .subject_table {
          overflow-x: auto;
          min-width: 900px;
        }
        .divider {
          display: none;
        }
        .address_motto {
          flex-direction: column;
        }
        .character {
          flex-direction: column;
        }
        .first_text {
          flex-direction: column;
        }
        .subjectName {
          width: 400px !important;
        }
        .container {
          padding: 20px;
        }
        .passport {
          width: 100px !important;
          height: 100px !important;
        }
        .passport_text {
          font-size: 12px !important;
        }
        .school_logo {
          width: 100px !important;
          height: 100px !important;
        }
        .text {
          flex-direction: column;
        }
        .items {
          width: 100% !important;
        }
       
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="report-card">
        <div
          class="header"
          style="
            display: flex;
            justify-content: space-between;
            gap: 20px;
            align-items: center;
            text-align: center;
          "
        >
          <div class="school_logo" style="border: 1px solid #000; width: 200px; height: 200px">
            <img
              src="<%= data.school.logo %>"
              alt="Logo"
              height="200"
              width="200"
              style="object-fit: contain"
            />
          </div>
          <div style="display: flex; align-items: center; flex-direction: column">
            <h1 style="color: #8c375c; font-size: 30px; margin: 0; text-align: center; font-weight: 900;">
              <%= data.school.name?.toUpperCase() %>
            </h1>
            <!-- <h5
              style="
                margin: 10px 0;
                color: #8c375c;
                font-size: 10px;
                font-weight: 400;
                border: 1px solid #8c375c;
                padding: 5px;
                border-radius: 8px;
              "
            >
              Motto:
              <%= data.school.motto %>
            </h5> -->

            <h4
              style="
                margin: 0;
                font-size: 18px;
                color: rgb(51, 71, 75);
                font-weight: 600;
                text-align: center;
              "
            >
              <%= data.school.address %>
            </h4>
            <div style="margin-bottom: 5px"></div>

            <div
              class="address_motto"
              style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px"
            >
              <h5 style="margin: 0; font-size: 15px; color: rgb(51, 71, 75)">
                Tel: 07064331791,
              </h5>
              <!-- <h5 style="margin: 0; font-size: 14px; color: rgb(51, 71, 75)">
                Email: busaahmad1@gmail.com
              </h5> -->
            </div>
            <h2 style="font-size: 24px; margin: 0; padding-top: 3px; text-transform: uppercase; font-weight: 700;">Junior Secondary School</h2>
            <div style="margin-top: 7px"></div>
            <h3 style="margin: 0; font-size: 24px; color: rgb(51, 71, 75); font-weight: 500; text-transform: uppercase; text-decoration: underline;">
              <%= data.student.className %>
             students terminal examination report sheet
            </h3>
          </div>
          <div
            class="passport"
            style="
              position: relative;
              border: 1px solid #000;
              width: 200px;
              height: 200px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <% if (data.student.passport) { %>
            <img
              src="<%= data.student.passport %>"
              alt="Passport"
              height="200"
              width="200"
              style="object-fit: contain"
            />
            <% } else { %>
            <div
              class="passport_text"
              style="
                position: absolute;
                color: #000;
                font-weight: bold;
                font-size: 20px;
                transform: rotate(-45deg);
                opacity: 0.5;
                text-align: center;
              "
            >
              Passport
            </div>
            <% } %>
          </div>
        </div>

         <!--  -->
         <div style="display: flex; justify-content: center;">
          <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 60%">
            <p style="margin: 0; font-size: 18px; line-height: 14px; font-weight: 700; text-transform: uppercase;">
             Report for
            </p>
            <div
              style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 16px; font-weight: 400"
            >
              <%= data.termName %>
            </div>
          <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 60%">
            <p style="margin: 0; font-size: 18px; line-height: 14px; font-weight: 700">
             TERM
            </p>
            <div
              style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 16px; font-weight: 400"
            >
              <%= data.sessionName %>
            </div>
          </div>
        </div>
        </div>

        <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 12px">
          <div> 
          <div class="text" style="display: flex; gap: 10px">
            <div class="items" style="display: flex; align-items: flex-end; width: 70%; gap: 4px">
              <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700;">Name of Student :</p>
              <div
                class="student-name"
                style="
                  flex: 1;
                  border-bottom: 1px solid #8c375c;
                  font-size: 16px;
                  font-weight: 400;
                  padding-left: 5px;
                "
              >
                <%= data.student.name %>
              </div>
            </div>

            <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 30%">
              <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700">
                Adm No :
              </p>
              <div
                style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 16px; font-weight: 400"
              >
                <%= data.student.regNumber %>
              </div>
            </div>
          </div>
          <div class="text" style="display: flex; gap: 20px; margin-top: 6px;">
             <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 30%">
              <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700">House:</p>
              <div
                style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 16px; font-weight: 400"
              >
                <%= data.student.house %>
              </div>
            </div>
            <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 40%">
              <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700">CLASS:</p>
              <div
                style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 16px; font-weight: 400"
              >
                <%= data.className %>
              </div>
            </div>
           <!-- Attendance -->
           <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 20%">
            <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700">
              Attendance:
            </p>
            <div
              style="flex: 1; font-size: 16px; font-weight: 400; border-bottom: 1px solid #8c375c"
            >
              <%= data.presentCount %>
            </div>
          </div>
          <!-- out ofclass -->
          <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 30%">
            <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700">
              Days out of:
            </p>
            <div
              style="flex: 1; font-size: 16px; font-weight: 400; border-bottom: 1px solid #8c375c"
            >
              <%= data.numberOfDaysOpened - data.presentCount %>
            </div>
          </div>
           
          </div>
          <div class="text" style="display: flex; gap: 20px; margin-top: 6px;">
            <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 40%">
              <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700">
                Position in class:
              </p>
              <div style="flex: 1; font-size: 16px; border-bottom: 1px solid #8c375c">
                <%= data.student.position %>
              </div>
            </div>
             <div class="items" style="display: flex; align-items: flex-end; gap: 4px; width: 20%">
              <p style="margin: 0; font-size: 14px; line-height: 14px; font-weight: 700">
                Out of:
              </p>
              <div
                style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 16px; font-weight: 400"
              >
                <%= data.numberInClass %>
              </div>
             </div>
           
          </div>
        </div>
        <div style="margin-top: 30px; overflow-x: auto">
          <table
            class="subject_table"
            style="
              border: 1px solid #8c375c;
              width: 100%;
              table-layout: fixed;
              border-collapse: collapse;
            "
          >
          <thead>
            <tr>
              <th rowspan="2" style="width: 20%; font-size: 16px; padding: 5px; font-weight: 700">
                SUBJECTS
              </th>
              <th colspan="2" style="font-size: 14px; font-weight: 700">C/A (40%)</th>
              <th rowspan="2" style="font-size: 14px">C/A Total</th>
              <th rowspan="2" style="font-size: 14px">EXAM (60%)</th>
              <th rowspan="2" style="font-size: 14px">TOTAL</th>
              <th rowspan="2" style="font-size: 14px">GRADE</th>
              <th rowspan="2" style="font-size: 14px">POSITION</th>
              <th rowspan="2" style="font-size: 14px">REMARK</th>
              <th rowspan="2" style="font-size: 14px">SIGNATURE</th> <!-- NEW COLUMN -->
            </tr>
            <tr>
              <th style="font-size: 14px">20</th>
              <th style="font-size: 14px">20</th>
            </tr>
          </thead> 
          <tbody>
            <% data?.subjects?.forEach(function({
              subjectName,
              subjectId,
              id1,
              id2,
              exam,
              total,
              averageScore,
              grade,
              comment,
              sign,
              assessments,
              position
            }) { %>
            <tr>
              <td class="subjectName" style="font-size: 14px; padding: 5px; font-weight: 700">
                <%= subjectName %>
              </td>
              <td style="font-size: 14px; padding-left: 5px">
                <%= assessments ? assessments[0] : '' %>
              </td>
              <td style="font-size: 14px; padding-left: 5px">
                <%= assessments ? assessments[1] : '' %>
              </td>
              <td style="font-size: 14px; padding-left: 5px">
                <%= assessments ? assessments[0] + assessments[1] : '' %>
              </td>
              <td style="font-size: 14px; padding-left: 5px">
                <%= assessments ? assessments[2] : '' %>
              </td>
              <td style="font-size: 14px; padding-left: 5px"><%= total %></td>
              <td style="font-size: 14px; padding-left: 5px"><%= grade ? grade?.label : '' %></td>
              <td style="font-size: 14px; padding-left: 5px">
                <% function getOrdinal(position) {
                     if (!position) return '';
                     if (position % 10 === 1 && position % 100 !== 11) return `${position}st`;
                     if (position % 10 === 2 && position % 100 !== 12) return `${position}nd`;
                     if (position % 10 === 3 && position % 100 !== 13) return `${position}rd`;
                     return `${position}th`;
                   } %>
                <%= getOrdinal(position) %>
              </td>
              <td style="font-size: 14px; padding-left: 5px">
                <%= grade ? grade?.description : "" %>
              </td>
              <td style="font-size: 14px; padding-left: 5px">
                <%= sign || '' %>
              </td>              
            </tr>
            <% }); %>
          </tbody>  
          <tfoot style="border:none; border-bottom: 2px solid #8c375c; ">
            <tr style="border-left: none; border-right: none;">
              <td colspan="2" style="font-weight: 700; font-size: 14px; text-align: left; padding-right: 10px; border: none;">
                Total:
              </td>
              <td colspan="2" style="border-top: none; border-left: none; border-right: none;"></td>
          
              <td style="font-weight: 700; font-size: 14px; text-align: left; padding-right: 10px; border: none;">
                Average:
              </td>
              <td style=" border-top: none; border-left: none; border-right: none;"></td>
          
              <td colspan="2" style="font-weight: 700; font-size: 14px; text-align: left; padding-right: 10px; border: none;">
                Class Average:
              </td>
              <td colspan="2" style="border-top: none; border-left: none; border-right: none;"></td>
            </tr>
          </tfoot>
          
          
             
          </table>
        </div>

        <div>
          <table style="width: 100%; table-layout: fixed; border-collapse: collapse; margin-top: 10px; font-size: 12px;">
            <tr>
              <!-- KEY TO GRADES COLUMN -->
              <td style="width: 25%; vertical-align: top; ">
                <table style="width: 100%; border: 2px solid #8c375c; border-collapse: collapse;">
                  <thead>
                    <tr>
                      <th style="border: 2px solid #8c375c; padding: 5px;">KEY TO GRADES</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% data.grades.forEach(function(grade) { %>
                    <tr>
                      <td style="border: 2px solid #8c375c; padding: 5px;">
                        <%= grade.label %> = <%= grade.description %>
                      </td>
                    </tr>
                    <% }); %>
                  </tbody>
                </table>
              </td>
          
              <!-- AFFECTIVE AREAS COLUMN -->
              <td style="width: 33%; vertical-align: top;">
                
                <table style="width: 100%; border: 2px solid #8c375c; border-collapse: collapse;">
                  <thead>
                    <tr>
                      <th style="border: 2px solid #8c375c; padding: 5px;">Character Development (A-E)</th>
                      <th style="border: 2px solid #8c375c; padding: 5px;">GRADE</th>
                      <th style="border: 2px solid #8c375c; padding: 5px;">SIGNATURE</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% data.character_development.forEach(function(character) { %>
                    <tr>
                      <td style="border: 2px solid #8c375c; padding: 5px;"><%= character.name %></td>
                      <td style="border: 2px solid #8c375c; padding: 5px;"><%= character.value %></td>
                      <td style="border: 2px solid #8c375c; padding: 5px;"></td>
                    </tr>
                    <% }); %>
                  </tbody>
                </table>
              </td>
          
              <!-- PSYCHOMOTOR SKILLS COLUMN -->
              <td style="width: 33%; vertical-align: top;">
                
                <table style="width: 100%; border: 2px solid #8c375c; border-collapse: collapse;">
                  <thead>
                    <tr>
                      <th style="border: 2px solid #8c375c; padding: 5px;">Practical Skills</th>
                      <th style="border: 2px solid #8c375c; padding: 5px;">GRADE</th>
                      <th style="border: 2px solid #8c375c; padding: 5px;">SIGNATURE</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% data.practical_skills.forEach(function(skill) { %>
                    <tr>
                      <td style="border: 2px solid #8c375c; padding: 5px;"><%= skill.name %></td>
                      <td style="border: 2px solid #8c375c; padding: 5px;"><%= skill.value %></td>
                      <td style="border: 2px solid #8c375c; padding: 5px;"></td>
                    </tr>
                    <% }); %>
                  </tbody>
                </table>
              </td>
            </tr>
          </table>
          
        </div>
        
        

 <div style="margin-top: 10px">
          <div
          style="
            display: flex;
            align-items: flex-end;
            gap: 4px;
            margin-top: 20px;
            font-size: 14px;
          "
        >
          <p style="margin: 0; font-weight: 700; text-transform: capitalize">
            Class Teacher's Remark:
          </p>
          <div style="border-bottom: 1px solid #8c375c; flex: 1">
            <%= data?.classTeacherRemark %>
          </div>
        </div>

          <!-- <div class="first_text" style="display: flex; gap: 10px ; margin-top: 20px">
            <div style="flex: 1; display: flex; align-items: flex-end; gap: 4px">
              <p style="margin: 0; font-size: 14px; font-weight: 700; text-transform: uppercase">
                Position In Class:
              </p>
              <div
                style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 14px; font-weight: 400"
              >
                <% 
                  let position = data?.overAllPosition || 0;
                  let ordinal;
                  if (position % 10 === 1 && position % 100 !== 11) {
                    ordinal = `${position}st`;
                  } else if (position % 10 === 2 && position % 100 !== 12) {
                    ordinal = `${position}nd`;
                  } else if (position % 10 === 3 && position % 100 !== 13) {
                    ordinal = `${position}rd`;
                  } else {
                    ordinal = `${position}th`;
                  }
                %>
                <%= ordinal %>
              </div>
            </div>

            <div style="flex: 1; display: flex; align-items: flex-end; gap: 4px">
              <p style="margin: 0; font-size: 14px; font-weight: 700; text-transform: uppercase">
                Class Average (class Total Score/no Of Pupils)
              </p>
              <div
                style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 14px; font-weight: 400"
              >
              <%= data.annualRecord.annualAverageScore || "0" %>
              </div>
            </div>
          </div> -->
       <div style="display: flex; gap: 10px;">
        <div
        style="
          display: flex;
          align-items: flex-end;
          margin-top: 20px;
          font-size: 14px;
          width: 50%;
        "
      >
        <p style="margin: 0; font-weight: 700; text-transform: capitalize;  ">
          Signature:
        </p>
        <div style="border-bottom: 1px solid #8c375c; flex: 1">
          <%= data?.teachersignature %>
        </div>
      </div>
      <div
      style="
        display: flex;
        align-items: flex-end;
        gap: 4px;
        margin-top: 20px;
        font-size: 14px;
        width: 50%;
      "
    >
      <p style="margin: 0; font-weight: 700; text-transform: capitalize">
      Date:
      </p>
      <div style="border-bottom: 1px solid #8c375c; flex: 1">
        <%= data?.date %>
      </div>
      </div>
   </div>

   <div
   style="
     display: flex;
     font-size: 14px;
     align-items: flex-end;
     gap: 4px;
     margin-top: 20px;
     
   "
 >
   <p style="margin: 0; font-weight: 700; text-transform: capitalize">
     Principal's Remark:
   </p>
   <div style="border-bottom: 1px solid #8c375c; flex: 1">
     <%= data?.principalRemark %>
   </div>
 </div>

         <div style="display: flex; gap: 10px;">
          <div
          style="
            display: flex;
            font-size: 14px;
            align-items: flex-end;
            gap: 4px;
            margin-top: 20px;
            width: 50%;
          "
        >
          <p style="margin: 0; font-weight: 700; text-transform: capitalize">Signature</p>
          <div style="border-bottom: 1px solid #8c375c; flex: 1">
            <%= data?.principalSignature %>
          </div>
        </div>
        
        <div
        style="
          display: flex;
          align-items: flex-end;
          gap: 4px;
          margin-top: 20px;
          font-size: 14px;
          width: 50%;
        "
      >
        <p style="margin: 0; font-weight: 700; text-transform: capitalize">
        Date:
        </p>
        <div style="border-bottom: 1px solid #8c375c; flex: 1">
          <%= data?.date %>
        </div>
        </div>
         </div>

          <div style="display: flex; align-items: flex-end; gap: 4px; margin-top: 20px">
            <p style="margin: 0; font-size: 14px; font-weight: 700">NEXT TERM BEGINS:</p>
            <div
              style="flex: 1; border-bottom: 1px solid #8c375c; font-size: 14px; font-weight: 400"
            >
              <%= data?.nextTermBegin %>
            </div>
          </div>
          <!-- <div
            style="
              display: flex;
              font-size: 14px;
              align-items: center;
              gap: 20px;
              margin-top: 20px;
              justify-content: space-between;
            "
          >
            <div style="display: flex; font-size: 14px; gap: 4px; width: 48%">
              <p style="margin: 0; font-weight: 700">PROMOTED TO:</p>
              <div style="border-bottom: 1px solid #8c375c; flex: 1">
                <%= data?.promoted ? data.nextClassName : '' %>
              </div>
            </div>
            <div style="display: flex; font-size: 14px; gap: 4px; width: 48%">
              <p style="margin: 0; font-weight: 700">TO REPEAT:</p>
              <div style="border-bottom: 1px solid #8c375c; flex: 1">
                <%= data?.promoted ? '' : data.className %>
              </div>
            </div>
          </div> -->
        </div>
      </div>
      <div class="divider" style="width: 3000px; height: 1px"></div>
    </div>
  </body>
</html>
